<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>團隊管理 - NBEE 系統</title>
    <link rel="stylesheet" href="styles/globals.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 添加Lucide圖標庫CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 模態框樣式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem 1rem;
        }

        .modal-overlay.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin: auto;
            position: relative;
            overflow: hidden;
        }

        /* 登入日誌模態框專用樣式 */
        #view-log-modal .modal {
            max-width: 1200px; /* 大幅增加寬度 */
            width: 95%;
        }
        
        .modal-lg {
            max-width: 1100px;
            width: 95%;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .modal-lg .modal-header {
            background: hsl(var(--primary) / 0.05);
            border-bottom: 1px solid hsl(var(--border));
            padding: var(--space-5) var(--space-6);
        }
        
        .modal-lg .modal-title {
            font-size: var(--text-xl);
            color: hsl(var(--primary));
        }
        
        .modal-lg .modal-body {
            padding: var(--space-6);
            background-color: #ffffff; /* 確保背景為純白色 */
        }
        
        .modal-lg .modal-footer {
            background: hsl(var(--muted) / 0.1);
            border-top: 1px solid hsl(var(--border));
            padding: var(--space-4) var(--space-6);
            display: flex;
            justify-content: flex-end;
        }
        
        /* 用戶資訊卡片 */
        .user-info-card {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 0;
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .user-info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px;
            background: linear-gradient(to right, #f8f9fa, #f1f3f5);
            border-bottom: 1px solid #e9ecef;
        }
        
        .user-info-left {
            display: flex;
            align-items: center;
        }
        
        .user-info-details {
            margin-left: 16px;
        }
        
        .user-device-info {
            margin-top: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            background: #ffffff;
            border: 1px solid #edf2f7;
            border-radius: var(--radius-sm);
            padding: var(--space-3);
        }
        
        .device-row {
            display: flex;
            align-items: center;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .user-avatar-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #4263eb;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 4px;
        }
        
        .user-email {
            font-size: 14px;
            color: #6c757d;
        }
        
        /* 裝置資訊容器 - 右側 */
        .device-info-container {
            display: grid;
            grid-template-columns: repeat(2, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .device-info-item {
            display: flex;
            align-items: flex-start;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            border-left: 2px solid #4263eb;
        }
        
        .device-icon {
            color: #4263eb;
            margin-right: 10px;
            margin-top: 2px;
        }
        
        .device-label {
            font-size: 11px;
            color: #6c757d;
            margin-bottom: 2px;
        }
        
        .device-value {
            font-size: 13px;
            color: #212529;
            font-weight: 500;
        }
        
        .user-info-header .user-device, 
        .user-info-header .user-location {
            display: flex;
            align-items: center;
            color: #64748b;
            font-size: 14px;
        }
        
        .location-icon {
            margin-right: var(--space-2);
            width: 16px;
            height: 16px;
            color: #64748b;
        }
        
        .user-location {
            color: #64748b;
        }
        
        /* 登入記錄區域 */
        .login-history-section {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #343a40;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* 表格樣式 */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table th {
            background: #f8f9fa;
            color: #495057;
            font-weight: 600;
            text-align: left;
            padding: 12px 16px;
            border-bottom: 2px solid #dee2e6;
            font-size: 14px;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
            color: #495057;
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
        }
        
        /* 狀態標籤 */
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-success {
            background-color: rgba(25, 135, 84, 0.1);
            color: #198754;
        }
        
        .status-failed {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .status-locked {
            background-color: rgba(255, 193, 7, 0.1);
            color: #fd7e14;
        }
        
        .mt-4 {
            margin-top: var(--space-4);
        }
        
        .table-container {
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        /* 團隊管理頁面特定樣式 */
        .app-layout {
            display: flex;
            min-height: 100vh;
            background: hsl(var(--background));
        }

        /* 側邊欄樣式 */
        .sidebar {
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid hsl(var(--border));
            transition: width var(--duration-300) ease;
            position: relative;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar-header {
            padding: var(--space-4);
            border-bottom: 1px solid hsl(var(--border));
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .sidebar-brand {
            font-size: var(--text-xl);
            font-weight: 700;
            color: hsl(var(--foreground));
            white-space: nowrap;
            transition: opacity var(--duration-300) ease;
        }

        .sidebar.collapsed .sidebar-brand {
            opacity: 0;
        }

        .sidebar-collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius);
            color: hsl(var(--muted-foreground));
            transition: all var(--duration-150);
            flex-shrink: 0;
        }

        .sidebar-collapse-btn:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .sidebar-nav {
            padding: var(--space-4) 0;
        }

        .nav-section {
            margin-bottom: var(--space-6);
        }

        .nav-section-title {
            padding: var(--space-2) var(--space-4);
            font-size: var(--text-xs);
            font-weight: 600;
            color: hsl(var(--muted-foreground));
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-2);
        }

        .sidebar.collapsed .nav-section-title {
            opacity: 0;
            height: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-4);
            color: hsl(var(--muted-foreground));
            text-decoration: none;
            transition: all var(--duration-150);
            white-space: nowrap;
            position: relative;
        }

        .nav-item:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .nav-item.active {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: var(--space-3);
            flex-shrink: 0;
            transition: margin var(--duration-300) ease;
            display: inline-block;
            font-size: 16px;
            line-height: 1;
            text-align: center;
        }

        .nav-item-text {
            flex: 1;
            transition: opacity var(--duration-300) ease;
        }

        /* 縮小時的樣式 */
        .sidebar.collapsed .nav-item {
            padding: var(--space-3);
            justify-content: center;
        }

        .sidebar.collapsed .nav-icon {
            margin-right: 0;
            opacity: 1;
            visibility: visible;
            display: inline-block;
            font-size: 18px;
            color: hsl(var(--foreground));
        }

        .sidebar.collapsed .nav-item-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            visibility: hidden;
        }

        /* 工具提示 */
        .sidebar.collapsed .nav-item:hover::after {
            content: attr(data-title);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: hsl(var(--foreground));
            color: hsl(var(--background));
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius);
            font-size: var(--text-sm);
            white-space: nowrap;
            z-index: 1000;
            margin-left: var(--space-2);
            box-shadow: var(--shadow-md);
        }

        /* 主內容區域 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: hsl(var(--background));
        }

        .main-header {
            background: white;
            border-bottom: 1px solid hsl(var(--border));
            padding: var(--space-4) var(--space-6);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            font-size: var(--text-2xl);
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: var(--text-sm);
        }

        .language-selector {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius);
            color: hsl(var(--muted-foreground));
            transition: all var(--duration-150);
        }

        .language-selector:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        /* 團隊管理內容 */
        .team-content {
            flex: 1;
            padding: var(--space-6);
        }

        .team-header {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: var(--space-6);
            max-width: 1300px; /* 與表格寬度一致 */
            width: 100%;
        }

        .team-title {
            font-size: var(--text-2xl);
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .team-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .filter-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            font-size: var(--text-sm);
            width: 220px;
            background: white;
        }

        .filter-input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }

        .filter-select {
            padding: var(--space-2) var(--space-3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            font-size: var(--text-sm);
            width: 130px;
            background: white;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }

        /* 團隊成員表格 - 調整為1300px寬度 */
        .team-table {
            background: white;
            border-radius: var(--radius);
            border: 1px solid hsl(var(--border));
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            max-width: 1300px; /* 調整到 1300px */
        }

        .team-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .team-table th {
            background: #f8f9fa;
            padding: var(--space-3);
            text-align: left;
            font-weight: 600;
            color: hsl(var(--foreground));
            border-bottom: 1px solid hsl(var(--border));
            font-size: var(--text-xs);
        }

        .team-table td {
            padding: var(--space-3);
            border-bottom: 1px solid hsl(var(--border));
            vertical-align: middle;
            font-size: var(--text-sm);
        }

        /* 調整欄位寬度分配 */
        .team-table th:nth-child(1) { width: 25%; } /* User Name 欄位 */
        .team-table th:nth-child(2) { width: 25%; } /* User Email 欄位 */
        .team-table th:nth-child(3) { width: 20%; } /* Last Login 欄位 */
        .team-table th:nth-child(4) { width: 15%; } /* Role 欄位 */
        .team-table th:nth-child(5) { width: 8%; }  /* 編輯欄位 */
        .team-table th:nth-child(6) { width: 7%; }  /* Action 欄位 */

        .team-table tr:last-child td {
            border-bottom: none;
        }

        .team-table tr:hover {
            background: hsl(var(--accent) / 0.5);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-2); /* 從 space-3 減少到 space-2 */
        }

        .user-avatar-small {
            width: 28px; /* 從 32px 減少到 28px */
            height: 28px;
            border-radius: 50%;
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: var(--text-xs); /* 從 text-sm 減少到 text-xs */
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-email {
            font-weight: 500;
            color: hsl(var(--foreground));
            font-size: var(--text-sm); /* 確保郵箱字體適中 */
        }

        .user-tag {
            font-size: var(--text-xs);
            color: hsl(var(--muted-foreground));
            background: hsl(var(--muted));
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 2px;
            display: inline-block;
            width: fit-content;
        }

        .status-badge {
            padding: var(--space-1) var(--space-2);
            border-radius: 12px;
            font-size: var(--text-xs);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-invited {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .role-badge {
            padding: var(--space-1) var(--space-2);
            border-radius: 12px;
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .role-owner {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .role-sales {
            background: hsl(var(--foreground));
            color: hsl(var(--background));
        }

        .role-member {
            background: hsl(var(--muted));
            color: hsl(var(--muted-foreground));
        }

        .role-pending {
            background: hsl(var(--muted));
            color: hsl(var(--muted-foreground));
            border: 1px solid hsl(var(--muted-foreground));
        }

        .role-admin {
            background: hsl(var(--foreground));
            color: hsl(var(--background));
        }



        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--space-1); /* 從 space-2 減少到 space-1 */
            border-radius: var(--radius);
            color: hsl(var(--muted-foreground));
            transition: all var(--duration-150);
        }

        .action-btn:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .action-btn i {
            width: 14px; /* 從 16px 減少到 14px */
            height: 14px;
        }

        /* Action下拉選單樣式 */
        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            min-width: 160px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: none;
            background: none;
            text-align: left;
            font-size: var(--text-sm);
            color: hsl(var(--foreground));
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:hover {
            background: hsl(var(--muted));
        }

        .dropdown-item.danger {
            color: hsl(var(--destructive));
        }

        .dropdown-item.danger:hover {
            background: hsl(var(--destructive) / 0.1);
        }

        .dropdown-item i {
            width: 16px;
            height: 16px;
        }

        .team-stats {
            padding: var(--space-4);
            border-bottom: 1px solid hsl(var(--border));
            background: #f8f9fa;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 16px;
        }

        .stats-content {
            display: flex;
            align-items: baseline;
            gap: var(--space-2);
        }

        .stats-number {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: hsl(var(--foreground));
        }

        .stats-label {
            font-size: var(--text-sm);
            color: hsl(var(--muted-foreground));
            font-weight: 500;
        }

        .team-footer {
            padding: var(--space-4);
            border-top: 1px solid hsl(var(--border));
            color: hsl(var(--muted-foreground));
            font-size: var(--text-sm);
        }

        /* 邀請彈窗 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--duration-300);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--radius);
            padding: var(--space-6);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.95);
            transition: transform var(--duration-300);
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: hsl(var(--foreground));
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius);
            color: hsl(var(--muted-foreground));
            transition: all var(--duration-150);
        }

        .modal-close:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: 500;
            color: hsl(var(--foreground));
        }

        .form-input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            font-size: var(--text-sm);
            transition: all var(--duration-150);
        }

        .form-input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }

        .form-input[rows] {
            resize: vertical;
        }

        .email-textarea {
            min-height: 20px;
            resize: vertical;
        }

        .message-textarea {
            min-height: 60px !important;
            resize: vertical;
        }

        .form-help {
            display: block;
            margin-top: var(--space-1);
            font-size: var(--text-xs);
            color: hsl(var(--muted-foreground));
        }

        .form-select {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            font-size: var(--text-sm);
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
        }

        .invite-tabs {
            display: flex;
            border-bottom: 1px solid hsl(var(--border));
            margin-bottom: var(--space-4);
        }

        .invite-tab {
            flex: 1;
            padding: var(--space-3);
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            color: hsl(var(--muted-foreground));
            border-bottom: 2px solid transparent;
            transition: all var(--duration-150);
        }

        .invite-tab.active {
            color: hsl(var(--foreground));
            border-bottom-color: hsl(var(--primary));
        }

        .invite-tab-content {
            display: none;
        }

        .invite-tab-content.active {
            display: block;
        }

        .copy-link-section {
            background: hsl(var(--muted));
            padding: var(--space-4);
            border-radius: var(--radius);
            margin-bottom: var(--space-4);
        }

        .copy-link-input {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .copy-link-input input {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            font-size: var(--text-sm);
            background: white;
        }

        .copy-btn {
            padding: var(--space-2) var(--space-3);
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: var(--text-sm);
            transition: all var(--duration-150);
        }

        .copy-btn:hover {
            background: hsl(var(--primary) / 0.9);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
            margin-top: var(--space-6);
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                bottom: 0;
                z-index: 100;
                transition: left var(--duration-300) ease;
            }

            .sidebar.show {
                left: 0;
            }

            .sidebar.collapsed {
                width: 280px;
            }

            .team-actions {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);

                
            }

            .filter-input {
                width: 100%;
            }

            .team-table {
                overflow-x: auto;
            }

            .team-table table {
                min-width: 600px;
            }
        }

        /* 開發者提示 */
        .dev-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .dev-hint:hover {
            opacity: 1;
        }

        .dev-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: rgba(108, 117, 125, 0.9);
            color: white;
            border-radius: 50%;
            cursor: help;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
        }

        .dev-indicator::before {
            content: '?';
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- 側邊欄 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">SMART</div>
                <button class="sidebar-collapse-btn" id="sidebarToggle">
                    <span class="nav-icon">◀</span>
                </button>
            </div>
            <nav class="sidebar-nav">
                <!-- 主要功能 -->
                <div class="nav-section">
                    <div class="nav-section-title">主要功能</div>
                    <a href="#" class="nav-item" data-title="Overview">
                        <i data-lucide="home" class="nav-icon"></i>
                        <span class="nav-item-text">Overview</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Pages">
                        <i data-lucide="file-text" class="nav-icon"></i>
                        <span class="nav-item-text">Pages</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Article">
                        <i data-lucide="file-edit" class="nav-icon"></i>
                        <span class="nav-item-text">Article</span>
                    </a>
                </div>

                <!-- 內容管理 -->
                <div class="nav-section">
                    <div class="nav-section-title">內容管理</div>
                    <a href="#" class="nav-item" data-title="Institution">
                        <i data-lucide="building" class="nav-icon"></i>
                        <span class="nav-item-text">Institution</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Booking">
                        <i data-lucide="calendar" class="nav-icon"></i>
                        <span class="nav-item-text">Booking</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Media Asset">
                        <i data-lucide="image" class="nav-icon"></i>
                        <span class="nav-item-text">Media Asset</span>
                    </a>
                </div>

                <!-- 系統管理 -->
                <div class="nav-section">
                    <div class="nav-section-title">系統管理</div>
                    <a href="#" class="nav-item active" data-title="Team">
                        <i data-lucide="users" class="nav-icon"></i>
                        <span class="nav-item-text">Team</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Role">
                        <i data-lucide="user" class="nav-icon"></i>
                        <span class="nav-item-text">Role</span>
                    </a>
                    <a href="#" class="nav-item" data-title="Settings">
                        <i data-lucide="settings" class="nav-icon"></i>
                        <span class="nav-item-text">Settings</span>
                    </a>
                </div>

                <!-- 幫助 -->
                <div class="nav-section">
                    <div class="nav-section-title">幫助</div>
                    <a href="#" class="nav-item" data-title="Faq">
                        <i data-lucide="help-circle" class="nav-icon"></i>
                        <span class="nav-item-text">Faq</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- 主內容區域 -->
        <main class="main-content">
            <!-- 頂部標題欄 -->
            <header class="main-header">
                <h1 class="header-title">Team</h1>
                <div class="header-actions">
                    <button class="language-selector">
                        🌐
                    </button>
                    <div class="user-avatar">A</div>
                </div>
            </header>

            <!-- 團隊管理內容 -->
            <div class="team-content">
                <div class="team-header">
                    <div class="team-actions">
                        <div class="filter-controls">
                            <select class="filter-select" id="statusFilter">
                                <option value="all">All Status</option>
                                <option value="suspend">Suspend</option>
                                <option value="pending">Pending</option>
                            </select>
                            <input type="text" class="filter-input" placeholder="Filter by name or email">
                        </div>
                        <button class="btn btn-primary" id="inviteBtn">
                            ➕ Invite
                        </button>
                    </div>
                </div>

                <!-- 團隊成員表格 -->
                <div class="team-table">
                    <div class="team-stats">
                        <div class="stats-content">
                            <span class="stats-number">7</span>
                            <span class="stats-label">Team Members</span>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User Name</th>
                                <th>User Email</th>
                                <th>Last Login</th>
                                <th>Role</th>
                                <th>編輯</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">J</div>
                                        <div class="user-details">
                                            <div class="user-name">josh</div>
                                            <span class="user-tag">You</span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">josh@heisoo.com</div>
                                </td>
                                <td>2024-08-18 14:25</td>
                                <td><span class="role-badge role-owner">Owner</span></td>
                                <td>
                                    <button class="action-btn" onclick="editMember(this.closest('tr'))">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <!-- Owner不需要Action選單，因為不能對自己執行任何操作 -->
                                    <span class="text-muted">-</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">W</div>
                                        <div class="user-details">
                                            <div class="user-name">winrabbit</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">winrabbit@gmail.com</div>
                                </td>
                                <td>2024-08-18 14:30</td>
                                <td><span class="role-badge role-member">Member</span></td>
                                <td>
                                    <button class="action-btn">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <div class="action-dropdown">
                                        <button class="action-btn dropdown-toggle" data-dropdown="dropdown-2">
                                            <i data-lucide="more-horizontal"></i>
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-2">
                                            <button class="dropdown-item" data-action="suspend" data-user="winrabbit@gmail.com">
                                                <i data-lucide="pause-circle"></i>
                                                Suspend
                                            </button>
                                            <button class="dropdown-item danger" data-action="delete" data-user="winrabbit@gmail.com">
                                                <i data-lucide="trash-2"></i>
                                                Delete
                                            </button>
                                            <button class="dropdown-item" data-action="view-log" data-user="winrabbit@gmail.com" onclick="showLoginLog('winrabbit@gmail.com')">
                                                <i data-lucide="file-text"></i>
                                                View Log
                                            </button>
                                            <button class="dropdown-item" data-action="switch-owner" data-user="winrabbit@gmail.com">
                                                <i data-lucide="crown"></i>
                                                Switch Owner
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">J</div>
                                        <div class="user-details">
                                            <div class="user-name">josh+10</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">josh+10@heiso.io</div>
                                </td>
                                <td>never</td>
                                <td><span class="role-badge role-member">Member</span></td>
                                <td>
                                    <button class="action-btn">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <div class="action-dropdown">
                                        <button class="action-btn dropdown-toggle" data-dropdown="dropdown-3">
                                            <i data-lucide="more-horizontal"></i>
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-3">
                                            <button class="dropdown-item" data-action="send-again" data-user="josh+10@heiso.io">
                                                <i data-lucide="mail"></i>
                                                Send Again
                                            </button>
                                            <button class="dropdown-item" data-action="invitation-link" data-user="josh+10@heiso.io">
                                                <i data-lucide="link"></i>
                                                Invitation Link
                                            </button>
                                            <button class="dropdown-item danger" data-action="delete" data-user="josh+10@heiso.io">
                                                <i data-lucide="trash-2"></i>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                         
                              
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">J</div>
                                        <div class="user-details">
                                            <div class="user-name">josh+7</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">josh+7@heiso.io</div>
                                </td>
                                <td>2024-08-18 13:45</td>
                                <td><span class="role-badge role-sales">sales</span></td>
                                <td>
                                    <button class="action-btn">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <div class="action-dropdown">
                                        <button class="action-btn dropdown-toggle" data-dropdown="dropdown-5">
                                            <i data-lucide="more-horizontal"></i>
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-5">
                                            <button class="dropdown-item" data-action="suspend" data-user="josh+7@heiso.io">
                                                <i data-lucide="pause-circle"></i>
                                                Suspend
                                            </button>
                                            <button class="dropdown-item danger" data-action="delete" data-user="josh+7@heiso.io">
                                                <i data-lucide="trash-2"></i>
                                                Delete
                                            </button>
                                            <button class="dropdown-item" data-action="view-log" data-user="josh+7@heiso.io">
                                                <i data-lucide="file-text"></i>
                                                View Log
                                            </button>
                                            <button class="dropdown-item" data-action="switch-owner" data-user="josh+7@heiso.io">
                                                <i data-lucide="crown"></i>
                                                Switch Owner
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">T</div>
                                        <div class="user-details">
                                            <div class="user-name">test</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">test@heisoo.com</div>
                                </td>
                                <td>2024-08-18 12:20</td>
                                <td><span class="role-badge role-admin">Admin</span></td>
                                <td>
                                    <button class="action-btn">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <div class="action-dropdown">
                                        <button class="action-btn dropdown-toggle" data-dropdown="dropdown-6">
                                            <i data-lucide="more-horizontal"></i>
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-6">
                                            <button class="dropdown-item" data-action="suspend" data-user="test@heisoo.com">
                                                <i data-lucide="pause-circle"></i>
                                                Suspend
                                            </button>
                                            <button class="dropdown-item danger" data-action="delete" data-user="test@heisoo.com">
                                                <i data-lucide="trash-2"></i>
                                                Delete
                                            </button>
                                            <button class="dropdown-item" data-action="view-log" data-user="test@heisoo.com">
                                                <i data-lucide="file-text"></i>
                                                View Log
                                            </button>
                                            <button class="dropdown-item" data-action="switch-owner" data-user="test@heisoo.com">
                                                <i data-lucide="crown"></i>
                                                Switch Owner
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar-small">W</div>
                                        <div class="user-details">
                                            <div class="user-name">winrabbit+10</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="user-email">winrabbit+10@gmail.com</div>
                                </td>
                                <td>2024-08-18 11:15</td>
                                <td><span class="role-badge role-sales">sales</span></td>
                                <td>
                                    <button class="action-btn">
                                        <i data-lucide="edit-2"></i>
                                    </button>
                                </td>
                                <td>
                                    <div class="action-dropdown">
                                        <button class="action-btn dropdown-toggle" data-dropdown="dropdown-7">
                                            <i data-lucide="more-horizontal"></i>
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-7">
                                            <button class="dropdown-item" data-action="suspend" data-user="winrabbit+10@gmail.com">
                                                <i data-lucide="pause-circle"></i>
                                                Suspend
                                            </button>
                                            <button class="dropdown-item danger" data-action="delete" data-user="winrabbit+10@gmail.com">
                                                <i data-lucide="trash-2"></i>
                                                Delete
                                            </button>
                                            <button class="dropdown-item" data-action="view-log" data-user="winrabbit+10@gmail.com">
                                                <i data-lucide="file-text"></i>
                                                View Log
                                            </button>
                                            <button class="dropdown-item" data-action="switch-owner" data-user="winrabbit+10@gmail.com">
                                                <i data-lucide="crown"></i>
                                                Switch Owner
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- 邀請彈窗 -->
    <div class="modal-overlay" id="inviteModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Invite Team Member</h3>
                <button class="modal-close" id="closeModal">
                    ✕
                </button>
            </div>
            
                 <div class="invite-tab-content active" id="emailTab">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <textarea class="form-input email-textarea" rows="3" placeholder="Enter email address (e.g., user@example.com)"></textarea>
                    <small class="form-help">Enter the email address of the person you want to invite</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select">
                        <option value="member">Member</option>
                        <option value="sales">Sales</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Message (Optional)</label>
                    <textarea class="form-input message-textarea" rows="1" placeholder="Add a personal message to your invitation"></textarea>
                </div>
            </div>

            <div class="invite-tab-content" id="linkTab">
                <div class="copy-link-section">
                    <p style="margin-bottom: var(--space-3); color: hsl(var(--muted-foreground)); font-size: var(--text-sm);">
                        Share this link with anyone you want to invite to your team. They'll be able to join as a member.
                    </p>
                    <div class="copy-link-input">
                        <input type="text" value="https://nbee.app/invite/abc123def456" readonly>
                        <button class="copy-btn" id="copyLinkBtn">
                            <i data-lucide="clipboard"></i> Copy
                        </button>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelInvite">Cancel</button>
                <button class="btn btn-primary" id="sendInvite">Send Invitation</button>
            </div>
        </div>
    </div>
    
    <!-- 編輯成員彈窗 -->
    <div class="modal-overlay" id="edit-member-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">編輯成員</h3>
                <button class="modal-close" id="closeEditModal">
                    ✕
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-member-form">
                    <div class="form-group">
                        <label class="form-label" for="edit-user-name">User Name</label>
                        <input type="text" id="edit-user-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="edit-user-email">User Email</label>
                        <input type="email" id="edit-user-email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="edit-user-role">Role</label>
                        <select id="edit-user-role" class="form-select">
                            <option value="member">Member</option>
                            <option value="admin">Admin</option>
                            <!-- 已移除 owner 選項 -->
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="cancelEdit">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 登入日誌模態框 - 優化版 -->
    <div class="modal-overlay" id="view-log-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h3 class="modal-title">登入日誌</h3>
                <button class="modal-close" onclick="document.getElementById('view-log-modal').classList.remove('show')">
                    ✕
                </button>
            </div>
            <div class="modal-body">
                <!-- 用戶資訊卡片 -->
                <div class="user-info-card">
                    <div class="user-info-header">
                        <div class="user-info-left">
                            <div class="user-avatar-small" id="log-user-avatar">T</div>
                            <div class="user-info-details">
                                <div class="user-name" id="log-user-name">test</div>
                                <div class="user-email" id="log-user-email">test@heisoo.com</div>
                            </div>
                        </div>
                        <div class="device-info-container">
                            <div class="device-info-item">
                                <div class="device-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                                </div>
                                <div class="device-info">
                                    <div class="device-label">作業系統</div>
                                    <div class="device-value">Windows 11</div>
                                </div>
                            </div>
                            <div class="device-info-item">
                                <div class="device-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                                </div>
                                <div class="device-info">
                                    <div class="device-label">裝置型號</div>
                                    <div class="device-value">Dell XPS 15</div>
                                </div>
                            </div>
                            <div class="device-info-item">
                                <div class="device-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                </div>
                                <div class="device-info">
                                    <div class="device-label">位置</div>
                                    <div class="device-value">Taipei City, Taiwan</div>
                                </div>
                            </div>
                            <div class="device-info-item">
                                <div class="device-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                                </div>
                                <div class="device-info">
                                    <div class="device-label">IP 位址</div>
                                    <div class="device-value">192.168.1.105</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 登入記錄表格 -->
                <div class="login-history-section">
                    <h4 class="section-title">最近登入記錄</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>登入時間</th>
                                <th>結果</th>
                                <th>IP 位址</th>
                                <th>地理位置</th>
                                <th>裝置/瀏覽器</th>
                            </tr>
                        </thead>
                        <tbody id="login-log-table">
                            <!-- 日誌數據將由 JavaScript 動態填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('view-log-modal').classList.remove('show')">關閉</button>
            </div>
        </div>
    </div>
    
    <!-- 開發者測試提示 -->
    <div class="dev-hint" title="🧪 開發者測試帳號&#10;&#10;📧 josh@heisoo.com&#10;🔑 角色: Owner&#10;👥 當前頁面: 團隊管理">
        <span class="dev-indicator"></span>
    </div>

    <script src="scripts/app.js"></script>
    <script>
        // 初始化Lucide圖標
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // 為臨時密碼複製按鈕添加事件監聽器
            const copyTempPasswordBtn = document.getElementById('copyTempPasswordBtn');
            if (copyTempPasswordBtn) {
                copyTempPasswordBtn.addEventListener('click', function() {
                    const tempPasswordInput = document.getElementById('tempPasswordInput');
                    tempPasswordInput.select();
                    document.execCommand('copy');
                    
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i data-lucide="check"></i> Copied!';
                    
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        // 重新初始化 Lucide 圖標
                        if (typeof lucide !== 'undefined') {
                            lucide.createIcons();
                        }
                    }, 2000);
                });
            }
            
            // 生成隨機臨時密碼
            function generateTempPassword() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let password = '';
                for (let i = 0; i < 8; i++) {
                    password += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return password;
            }
            
            // 設置臨時密碼
            const tempPasswordInput = document.getElementById('tempPasswordInput');
            if (tempPasswordInput) {
                tempPasswordInput.value = generateTempPassword();
            }
        });
        
        // 打開模態框
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
            }
        }
        
        // 編輯成員
        function editMember(row) {
            const userNameElement = row.querySelector('.user-name');
            const emailElement = row.querySelector('.user-email');
            const roleElement = row.querySelector('.role-badge');
            
            const userName = userNameElement ? userNameElement.textContent : '';
            const email = emailElement ? emailElement.textContent : '';
            const role = roleElement ? getRoleValue(roleElement.textContent) : 'member';
            
            document.getElementById('edit-user-name').value = userName;
            document.getElementById('edit-user-email').value = email;
            document.getElementById('edit-user-role').value = role;
            
            openModal('edit-member-modal');
        }
        
        // 輔助函數：從角色顯示文本獲取角色值
        function getRoleValue(roleText) {
            roleText = roleText.toLowerCase();
            if (roleText.includes('owner')) return 'owner';
            if (roleText.includes('admin')) return 'admin';
            return 'member';
        }


        // 側邊欄折疊功能
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        let sidebarCollapsed = false;

        // 從 localStorage 讀取側邊欄狀態
        const savedState = localStorage.getItem('sidebarCollapsed');
        if (savedState === 'true') {
            sidebarCollapsed = true;
            sidebar.classList.add('collapsed');
            const icon = sidebarToggle.querySelector('.nav-icon');
            icon.textContent = '▶';
        }

        sidebarToggle.addEventListener('click', () => {
            sidebarCollapsed = !sidebarCollapsed;
            sidebar.classList.toggle('collapsed', sidebarCollapsed);
            
            // 保存狀態到 localStorage
            localStorage.setItem('sidebarCollapsed', sidebarCollapsed);
            
            // 更新圖標
            const icon = sidebarToggle.querySelector('.nav-icon');
            icon.textContent = sidebarCollapsed ? '▶' : '◀';
            console.log('Sidebar toggled, collapsed:', sidebarCollapsed);
        });



        // 邀請彈窗功能
        const inviteBtn = document.getElementById('inviteBtn');
        const inviteModal = document.getElementById('inviteModal');
        const closeModal = document.getElementById('closeModal');
        const cancelInvite = document.getElementById('cancelInvite');
        const sendInvite = document.getElementById('sendInvite');
        const copyLinkBtn = document.getElementById('copyLinkBtn');

        // 開啟彈窗
        inviteBtn.addEventListener('click', () => {
            inviteModal.classList.add('show');
        });

        // 關閉彈窗
        function closeInviteModal() {
            inviteModal.classList.remove('show');
        }

        closeModal.addEventListener('click', closeInviteModal);
        cancelInvite.addEventListener('click', closeInviteModal);

        // 點擊背景關閉彈窗
        inviteModal.addEventListener('click', (e) => {
            if (e.target === inviteModal) {
                closeInviteModal();
            }
        });

        // 發送邀請
        sendInvite.addEventListener('click', () => {
            const emailInput = document.querySelector('#emailTab .form-input');
            const email = emailInput.value.trim();
            
            // 驗證email格式
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!email) {
                alert('Please enter an email address');
                return;
            }
            
            if (!emailRegex.test(email)) {
                alert('Invalid email format');
                return;
            }
            
            sendInvite.classList.add('loading');
            sendInvite.textContent = 'Sending...';
            
            setTimeout(() => {
                sendInvite.classList.remove('loading');
                
                // 生成邀請鏈接
                const inviteLink = `https://nbee.app/invite/${Math.random().toString(36).substring(2, 15)}`;
                
                // 隱藏原本的表單內容
                const emailTab = document.getElementById('emailTab');
                
                // 生成6位數字的臨時密碼
                const tempPassword = Math.floor(100000 + Math.random() * 900000).toString();
                
                emailTab.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="margin-bottom: 16px;">
                            <i data-lucide="check-circle" style="width: 48px; height: 48px; color: #22c55e; margin-bottom: 16px;"></i>
                        </div>
                        <h3 style="margin-bottom: 16px; color: #22c55e;">Invitation Sent!</h3>
                        <p style="margin-bottom: 16px;">Share this link with the invitee:</p>
                        <div style="
                            background: #f5f5f5;
                            padding: 12px;
                            border-radius: 4px;
                            margin-bottom: 16px;
                            word-break: break-all;
                            font-family: monospace;
                            position: relative;
                            border: 1px solid #e5e5e5;
                        ">
                            <input type="text" value="${inviteLink}" readonly style="
                                width: calc(100% - 60px);
                                border: none;
                                background: transparent;
                                font-family: monospace;
                                font-size: 14px;
                                padding: 0;
                            " id="inviteLinkInput">
                            <button class="btn btn-secondary" onclick="
                                document.getElementById('inviteLinkInput').select();
                                document.execCommand('copy');
                                this.textContent = 'Copied!';
                                setTimeout(() => this.textContent = 'Copy', 2000);
                            " style="
                                position: absolute;
                                right: 8px;
                                top: 50%;
                                transform: translateY(-50%);
                                padding: 4px 8px;
                                font-size: 12px;
                            ">Copy</button>
                        </div>
                        
                        <!-- 臨時密碼部分 -->
                        <p style="margin-bottom: 8px;">Temporary Password (6-digit):</p>
                        <div style="
                            background: #f5f5f5;
                            padding: 12px;
                            border-radius: 4px;
                            margin-bottom: 16px;
                            position: relative;
                            border: 1px solid #e5e5e5;
                        ">
                            <input type="text" value="${tempPassword}" readonly style="
                                width: calc(100% - 60px);
                                border: none;
                                background: transparent;
                                font-family: monospace;
                                font-size: 20px;
                                padding: 0;
                                text-align: center;
                                letter-spacing: 4px;
                                font-weight: bold;
                            " id="tempPasswordInput">
                            <button class="btn btn-secondary" onclick="
                                document.getElementById('tempPasswordInput').select();
                                document.execCommand('copy');
                                this.textContent = 'Copied!';
                                setTimeout(() => this.textContent = 'Copy', 2000);
                            " style="
                                position: absolute;
                                right: 8px;
                                top: 50%;
                                transform: translateY(-50%);
                                padding: 4px 8px;
                                font-size: 12px;
                            ">Copy</button>
                        </div>
                        
                        <small style="display: block; margin-bottom: 16px; color: #ef4444;">
                            User will be required to change password after first login.
                        </small>
                        
                        <div style="
                            background: #f3f4f6;
                            padding: 12px;
                            border-radius: 4px;
                            margin-bottom: 16px;
                            font-size: 14px;
                            color: #4b5563;
                        ">
                            <strong>Expiration:</strong> This link and temporary password will expire in 48 hours.
                        </div>
                    </div>
                `;
                
                // 更新按鈕文字
                sendInvite.textContent = 'Close';
                sendInvite.onclick = () => {
                    closeInviteModal();
                    // 重置表單
                    location.reload();
                };
                
                // 重新初始化 Lucide 圖標
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }, 1500);
        });

        // 複製邀請鏈接
        copyLinkBtn.addEventListener('click', () => {
            const linkInput = copyLinkBtn.parentElement.querySelector('input');
            linkInput.select();
            document.execCommand('copy');
            
            // 顯示複製成功提示
            const originalText = copyLinkBtn.innerHTML;
            copyLinkBtn.innerHTML = '<i data-lucide="check"></i>';
            copyLinkBtn.style.background = 'hsl(var(--destructive))';
            
            setTimeout(() => {
                copyLinkBtn.innerHTML = originalText;
                copyLinkBtn.style.background = '';
                lucide.createIcons();
            }, 2000);
        });

        // 標籤切換功能
        const inviteTabs = document.querySelectorAll('.invite-tab');
        const inviteTabContents = document.querySelectorAll('.invite-tab-content');

        inviteTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                
                // 移除所有活動狀態
                inviteTabs.forEach(t => t.classList.remove('active'));
                inviteTabContents.forEach(c => c.classList.remove('active'));
                
                // 添加活動狀態
                tab.classList.add('active');
                document.getElementById(targetTab + 'Tab').classList.add('active');
            });
        });

        // 成員過濾功能 - 更新版本
        const filterInput = document.querySelector('.filter-input');
        const statusFilter = document.getElementById('statusFilter');
        const tableRows = document.querySelectorAll('.team-table tbody tr');

        function filterMembers() {
            const searchTerm = filterInput.value.toLowerCase();
            const selectedStatus = statusFilter.value;
            
            tableRows.forEach(row => {
                const email = row.querySelector('.user-email').textContent.toLowerCase();
                const statusElement = row.querySelector('.status-badge');
                let rowStatus = 'active'; // 預設狀態
                
                // 判斷成員狀態
                if (statusElement) {
                    const statusText = statusElement.textContent.toLowerCase();
                    if (statusText.includes('never')) {
                        rowStatus = 'pending';
                    } else if (statusText.includes('suspend')) {
                        rowStatus = 'suspend';
                    }
                }
                
                // 檢查是否符合搜尋條件
                const matchesSearch = email.includes(searchTerm);
                const matchesStatus = selectedStatus === 'all' || selectedStatus === rowStatus;
                
                if (matchesSearch && matchesStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        filterInput.addEventListener('input', filterMembers);
        statusFilter.addEventListener('change', filterMembers);

        // Action下拉選單功能
        document.addEventListener('DOMContentLoaded', function() {
            // 處理下拉選單切換
            document.querySelectorAll('.dropdown-toggle').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdownId = this.getAttribute('data-dropdown');
                    const dropdown = document.getElementById(dropdownId);
                    
                    // 關閉其他下拉選單
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        if (menu.id !== dropdownId) {
                            menu.classList.remove('show');
                        }
                    });
                    
                    // 切換當前下拉選單
                    dropdown.classList.toggle('show');
                });
            });

            // 處理下拉選單項目點擊
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.getAttribute('data-action');
                    const user = this.getAttribute('data-user');
                    
                    // 關閉下拉選單
                    this.closest('.dropdown-menu').classList.remove('show');
                    
                    // 執行對應操作
                    handleActionClick(action, user);
                });
            });

            // 點擊外部關閉下拉選單
            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            });
        });

        function handleActionClick(action, user) {
            // 檢查是否為Owner對自己執行suspend或delete操作
            const userRow = document.querySelector(`[data-user="${user}"]`).closest('tr');
            const roleElement = userRow.querySelector('.role-badge');
            const isOwner = roleElement && roleElement.classList.contains('role-owner');
            const hasYouTag = userRow.querySelector('.user-tag');
            
            if (isOwner && hasYouTag && (action === 'suspend' || action === 'delete')) {
                alert('Owner不能對自己執行此操作');
                return;
            }
            
            // 檢查是否為Owner對自己執行switch owner
            if (action === 'switch-owner') {
                if (roleElement && roleElement.classList.contains('role-owner')) {
                    alert('Owner無法將自己轉移給自己');
                    return;
                }
            }
            
            if (action === 'view-log') {
                showLoginLog(user);
                return;
            }
            
            switch(action) {
                case 'switch-owner':
                    // 檢查Owner唯一性約束
                    const currentOwners = document.querySelectorAll('.role-owner');
                    let currentOwnerEmail = null;
                    
                    // 找到當前的Owner
                    currentOwners.forEach(ownerBadge => {
                        const row = ownerBadge.closest('tr');
                        const emailElement = row.querySelector('.user-email');
                        if (emailElement && emailElement.textContent !== user) {
                            currentOwnerEmail = emailElement.textContent;
                        }
                    });
                    
                    if (currentOwnerEmail) {
                        const confirmMessage = `確定要將 ${user} 設為新的擁有者嗎？\n\n注意：${currentOwnerEmail} 將自動降級為 Admin 角色。`;
                        if (confirm(confirmMessage)) {
                            switchOwnership(user, currentOwnerEmail);
                        }
                    } else {
                        if (confirm(`確定要將 ${user} 設為新的擁有者嗎？`)) {
                            switchOwnership(user, null);
                        }
                    }
                    break;
                case 'suspend':
                    if (confirm(`確定要暫停 ${user} 的帳戶嗎？`)) {
                        console.log('Suspend user:', user);
                        // 這裡可以添加實際的API調用
                    }
                    break;
                case 'send-again':
                    if (confirm(`確定要重新發送邀請給 ${user} 嗎？`)) {
                        console.log('Resend invitation to:', user);
                        // 這裡可以添加實際的API調用
                        alert('邀請已重新發送！');
                    }
                    break;
                case 'invitation-link':
                    // 生成邀請鏈接和臨時密碼
                    const inviteLink = `https://nbee.app/invite/${Math.random().toString(36).substring(2, 15)}`;
                    // 生成6位數字的臨時密碼
                    const tempPassword = Math.floor(100000 + Math.random() * 900000).toString();
                    
                    // 創建模態對話框HTML
                    const modalHTML = `
                        <div id="invitation-link-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
                            <div style="background: white; padding: 24px; border-radius: 8px; max-width: 500px; width: 90%;">
                                <h3 style="margin: 0 0 16px 0; color: #1f2937;">Invitation Link for ${user}</h3>
                                <p style="margin: 0 0 16px 0; color: #6b7280;">Share this link with the invitee:</p>
                                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                    <input type="text" id="invite-link-input" value="${inviteLink}" readonly style="flex: 1; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb;">
                                    <button id="copy-invite-link" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Copy</button>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <p style="margin: 0 0 8px 0; color: #6b7280;">Temporary Password (6-digit):</p>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="text" id="temp-password-input" value="${tempPassword}" readonly style="flex: 1; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; font-family: monospace; letter-spacing: 2px; font-size: 18px; text-align: center;">
                                        <button id="copy-temp-password" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Copy</button>
                                    </div>
                                    <small style="display: block; margin-top: 4px; color: #ef4444;">User will be required to change password after first login.</small>
                                </div>
                                
                                <div style="background: #f3f4f6; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                                    <p style="margin: 0; color: #4b5563; font-size: 14px;">
                                        <strong>Expiration:</strong> This link and temporary password will expire in 48 hours.
                                    </p>
                                </div>
                                
                                <div style="display: flex; justify-content: flex-end;">
                                    <button id="close-invitation-modal" style="padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 4px; cursor: pointer;">Close</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // 添加模態對話框到頁面
                    document.body.insertAdjacentHTML('beforeend', modalHTML);
                    
                    // 添加事件監聽器
                    document.getElementById('copy-invite-link').addEventListener('click', function() {
                        const linkInput = document.getElementById('invite-link-input');
                        linkInput.select();
                        document.execCommand('copy');
                        this.textContent = 'Copied!';
                        setTimeout(() => {
                            this.textContent = 'Copy';
                        }, 2000);
                    });
                    
                    document.getElementById('copy-temp-password').addEventListener('click', function() {
                        const passwordInput = document.getElementById('temp-password-input');
                        passwordInput.select();
                        document.execCommand('copy');
                        this.textContent = 'Copied!';
                        setTimeout(() => {
                            this.textContent = 'Copy';
                        }, 2000);
                    });
                    
                    document.getElementById('close-invitation-modal').addEventListener('click', function() {
                        document.getElementById('invitation-link-modal').remove();
                    });
                    
                    // 點擊背景關閉模態對話框
                    document.getElementById('invitation-link-modal').addEventListener('click', function(e) {
                        if (e.target === this) {
                            this.remove();
                        }
                    });
                    break;
                case 'delete':
                    if (confirm(`確定要刪除 ${user} 嗎？此操作無法復原。`)) {
                        console.log('Delete user:', user);
                        // 這裡可以添加實際的API調用
                    }
                    break;
            }
        }

        // 新增：Owner轉移功能
        function switchOwnership(newOwnerEmail, oldOwnerEmail) {
            // 找到新Owner的行並更新角色
            const allRows = document.querySelectorAll('.team-table tbody tr');
            
            allRows.forEach(row => {
                const emailElement = row.querySelector('.user-email');
                const roleBadge = row.querySelector('.role-badge');
                
                if (emailElement && roleBadge) {
                    const email = emailElement.textContent;
                    
                    if (email === newOwnerEmail) {
                        // 設置新Owner
                        roleBadge.textContent = 'Owner';
                        roleBadge.className = 'role-badge role-owner';
                    } else if (email === oldOwnerEmail) {
                        // 降級原Owner為Admin
                        roleBadge.textContent = 'Admin';
                        roleBadge.className = 'role-badge role-admin';
                    }
                }
            });
            
            // 顯示成功訊息
            if (oldOwnerEmail) {
                alert(`Owner權限轉移成功！\n\n新Owner: ${newOwnerEmail}\n原Owner ${oldOwnerEmail} 已降級為Admin`);
            } else {
                alert(`${newOwnerEmail} 已設為Owner`);
            }
        }

        // 響應式側邊欄
        function handleResize() {
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('collapsed');
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize();
        
        // 顯示登入日誌
        function showLoginLog(userEmail) {
            // 獲取用戶名（從電子郵件中提取）
            const userName = userEmail.split('@')[0];
            
            // 設置模態框中的用戶信息
            document.getElementById('log-user-avatar').textContent = userName.charAt(0).toUpperCase();
            document.getElementById('log-user-name').textContent = userName;
            document.getElementById('log-user-email').textContent = userEmail;
            
            // 更新用戶裝置信息區域
            const userDeviceInfo = document.querySelector('.user-device-info');
            if (userDeviceInfo) {
                // 根據用戶名設置不同的裝置信息
                let os = 'Mac OS';
                let device = 'MacBook-Air';
                let location = 'Linkou District, New Taipei City, Taiwan';
                let ip = '220.128.110.37';
                
                if (userName.includes('test')) {
                    os = 'Windows 11';
                    device = 'Dell XPS 15';
                    location = 'Taipei City, Taiwan';
                    ip = '192.168.1.105';
                } else if (userName.includes('winrabbit')) {
                    os = 'iOS 16.5';
                    device = 'iPhone 13 Pro';
                    location = 'Taichung City, Taiwan';
                    ip = '203.145.92.178';
                }
                
                // 更新裝置信息HTML
                userDeviceInfo.innerHTML = `
                    <div class="device-row">
                        <div class="device-label">作業系統:</div>
                        <div class="device-value">${os}</div>
                    </div>
                    <div class="device-row">
                        <div class="device-label">裝置型號:</div>
                        <div class="device-value">${device}</div>
                    </div>
                    <div class="device-row">
                        <div class="device-label">位置:</div>
                        <div class="device-value">${location}</div>
                    </div>
                    <div class="device-row">
                        <div class="device-label">IP 位址:</div>
                        <div class="device-value">${ip}</div>
                    </div>
                `;
            }
            
            // 模擬登入日誌數據（實際應用中應從後端獲取）- 3條記錄
            const logData = [
                {
                    time: '2024-08-20 14:35:22',
                    result: 'success',
                    ip: '192.168.1.105',
                    location: 'Taipei City, Taiwan',
                    userAgent: 'Chrome 116.0 / Windows 11'
                },
                {
                    time: '2024-08-19 09:12:45',
                    result: 'failed',
                    ip: '192.168.1.105',
                    location: 'Taipei City, Taiwan',
                    userAgent: 'Chrome 116.0 / Windows 11'
                },
                {
                    time: '2024-08-18 18:27:33',
                    result: 'success',
                    ip: '203.145.92.178',
                    location: 'Taichung City, Taiwan',
                    userAgent: 'Edge 115.0 / Windows 11'
                }
            ];
            
            // 生成表格內容
            const tableBody = document.getElementById('login-log-table');
            tableBody.innerHTML = '';
            
            logData.forEach(log => {
                const row = document.createElement('tr');
                
                // 設置登入時間
                const timeCell = document.createElement('td');
                timeCell.textContent = log.time;
                row.appendChild(timeCell);
                
                // 設置登入結果（帶有狀態標籤）
                const resultCell = document.createElement('td');
                const resultBadge = document.createElement('span');
                resultBadge.className = `status-badge status-${log.result}`;
                resultBadge.textContent = log.result.charAt(0).toUpperCase() + log.result.slice(1);
                resultCell.appendChild(resultBadge);
                row.appendChild(resultCell);
                
                // 設置 IP 位址
                const ipCell = document.createElement('td');
                ipCell.textContent = log.ip;
                row.appendChild(ipCell);
                
                // 設置地理位置
                const locationCell = document.createElement('td');
                locationCell.textContent = log.location;
                row.appendChild(locationCell);
                
                // 設置裝置/瀏覽器信息
                const userAgentCell = document.createElement('td');
                userAgentCell.textContent = log.userAgent;
                row.appendChild(userAgentCell);
                
                tableBody.appendChild(row);
            });
            
            // 打開模態框
            openModal('view-log-modal');
        }
    </script>
</body>
</html>